<div id="system_server" style="padding-top: 4rem;"></div>
<div class="container-fluid py-3">
  <div class="row">
    <div class="settingContainer">
      <h3 class="mb-4">服务器设置</h3>
      <div class="mb-3">
        <label for="HttpPort" class="form-label">HTTP 端口</label>
        <input type="number" class="form-control" id="HttpPort" data-bind="Server.HttpPort">
      </div>
      <div class="mb-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="HttpsEnable" data-bind="Server.HttpsEnable">
          <label class="form-check-label" for="HttpsEnable">启用 HTTPS <small
              class="form-text text-muted">如果要启用建议配合lego证书管理
              或反向代理功能</small></label>
        </div>
      </div>
      <div class="mb-3">
        <label for="HttpsPort" class="form-label">HTTPS 端口</label>
        <input type="number" class="form-control" id="HttpsPort" data-bind="Server.HttpsPort">
      </div>
      <div class="mb-3">
        <label for="TlsCert" class="form-label">TLS 证书路径 ></label>
        <input type="text" class="form-control" id="TlsCert" data-bind="Server.TlsCert">
      </div>
      <div class="mb-3">
        <label for="TlsKey" class="form-label">TLS 私钥路径</label>
        <input type="text" class="form-control" id="TlsKey" data-bind="Server.TlsKey">
      </div>

      <div class="mb-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="IsRunInServerLess" data-bind="Server.IsRunInServerLess">
          <label class="form-check-label" for="IsRunInServerLess">ServerLess/Stateless 模式
            <small class="form-text text-muted">启用后，NasCore
              将以顺序执行的方式执行后台任务。你也需要增加一个触发器定时触发，否则耗时较长的后台任务/计划任务可能无法成功执行。</small>
          </label>
        </div>
      </div>
      <div class="mb-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="WebuiAndApiEnable" data-bind="Server.WebuiAndApiEnable">
          <label class="form-check-label" for="WebuiAndApiEnable">启用 WebUI和api <small
              class="form-text text-muted">关闭后后台也无法访问，你只能通过手动修改配置文件</small>
          </label>
        </div>
      </div>
      <div class="mb-3">
        <label for="WebUIPrefix" class="form-label">WebUI 前缀</label>
        <input type="text" class="form-control" id="WebUIPrefix" data-bind="Server.WebUIPrefix">
      </div>
      <div class="mb-3">
        <label for="WebUICdnPrefix" class="form-label">CDN前缀</label>
        <div class="btn-group mb-2 flex-wrap" role="group" aria-label="CDN选择" style="gap:0.5rem;flex-wrap:wrap;">
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://cdn.jsdmirror.com/gh/nas-core/nascore_static@main/');">jsdmirror</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://gcore.jsdelivr.net/gh/nas-core/nascore_static@main/');">gcore.jsdelivr</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://testingcf.jsdelivr.net/gh/nas-core/nascore_static@main/');">testingcf.jsdelivr</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://fastly.jsdelivr.net/gh/nas-core/nascore_static@main/');">fastly.jsdelivr</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://quantil.jsdelivr.net/gh/nas-core/nascore_static@main/');">quantil.jsdelivr</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="setCdnPrefix('https://raw.githubusercontent.com/nas-core/nascore_static/refs/heads/main/');">raw.github</button>
          <button type="button" class="btn btn-outline-primary btn-sm" onclick="WebUICdnPrefixAutoSet1();">github镜像</button>
          <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#githubMirrorModal">设置 GitHub Mirror</button>
        </div>
        <input type="text" class="form-control" id="WebUICdnPrefix" data-bind="WebUICdnPrefix">
      </div>
      <div class="mb-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="WebDavEnable" data-bind="Server.WebDavEnable">
          <label class="form-check-label" for="WebDavEnable">启用 WebDAV <small class="form-text text-muted">路径是
              /</small></label>
        </div>
      </div>
      <div class="mb-3">
        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="DefaultStaticFileServiceEnable"
            data-bind="Server.DefaultStaticFileServiceEnable">
          <label class="form-check-label" for="DefaultStaticFileServiceEnable">启用静态文件服务</label>
        </div>
      </div>
      <div class="mb-3">
        <label for="DefaultStaticFileServicePrefix" class="form-label">静态文件服务前缀 <a
            href="#system_webuiCDN">修改此项后可能要同步修改CDN配置</a></label>
        <input type="text" class="form-control" id="DefaultStaticFileServicePrefix"
          data-bind="Server.DefaultStaticFileServicePrefix">
      </div>
      <div class="mb-3">
        <label for="DefaultStaticFileServiceRoot" class="form-label">静态文件服务根目录</label>
        <input type="text" class="form-control" id="DefaultStaticFileServiceRoot"
          data-bind="Server.DefaultStaticFileServiceRoot">
      </div>
      <div class="mb-3">
        <label for="DefaultStaticFileServiceDownloadUrl" class="form-label">静态文件Github下载地址 (.zip)
          <button type="button" class="btn btn-outline-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#githubMirrorModal">设置 GitHub Mirror</button>

        </label>
        <input type="text" class="form-control" id="DefaultStaticFileServiceDownloadUrl"
          data-bind="Server.DefaultStaticFileServiceDownloadUrl">
      </div>
      <div class="mb-3">
        <button type="button" class="btn btn-primary" onclick="downloadStaticFile()">下载静态资源文件</button>
      </div>
    </div>
  </div>
</div>

<script>
  function setCdnPrefix(prefix) {
    document.getElementById('WebUICdnPrefix').value = prefix;
    const event = new Event('input', {bubbles: true});
    document.getElementById('WebUICdnPrefix').dispatchEvent(event);
  }
  function WebUICdnPrefixAutoSet1() {
    var mirror = document.getElementById("ThirdPartyExtGitHubDownloadMirror");
    var prefix = (mirror && mirror.value ? mirror.value : "https://github.akams.cn/") + 'https://raw.githubusercontent.com/nas-core/nascore_static/refs/heads/main/';
    setCdnPrefix(prefix);
  }
</script>
